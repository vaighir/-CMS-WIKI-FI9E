version: "3.9"

x-tomcat: &tomcat
  TOMCAT_USERNAME: tomcat
  TOMCAT_PASSWORD: tomcat
  TOMCAT_ALLOW_REMOTE_MANAGEMENT: "1"

x-mysql: &mysql
  MYSQL_ROOT_PASSWORD: root
  MYSQL_PASSWORD: password
  MYSQL_HOSTNAME: mysql
  MYSQL_PORT: "3306"
  MYSQL_DATABASE: test_db
  MYSQL_USER: user

services:
  tomcat:
    build: ./docker/tomcat/.
    #image: bitnami/tomcat:9.0-debian-10
    ports:
      - '80:8080'
    volumes:
      - 'tomcat:/bitnami'
#      - './webapps:/opt/bitnami/tomcat/webapps'
      - './webapps/ROOT/admin:/opt/bitnami/tomcat/webapps/ROOT/admin'
      - './webapps/ROOT/websites:/opt/bitnami/tomcat/webapps/ROOT/websites'
      - './readme.md:/opt/bitnami/tomcat/webapps/ROOT/readme.md'
      - './api/RestAPI/target/RestAPI/:/opt/bitnami/tomcat/webapps/RestAPI/'
    environment:
      <<: *tomcat
    container_name: "tomcat"
<<<<<<< HEAD
    links:
      - mysql
    depends_on:
      - mysql
    networks:
      - common-network
=======
    cap_add: [NET_ADMIN]
#    command: [" socat TCP-LISTEN:3306,fork TCP:mysql:3306"]
>>>>>>> fe0e4a1eb737b4e6b9a3e81e40343b289955ee3a

# Accessible outside the docker environment at localhost:3306
# Within the docker environment the database is accessible at mysql:3306
  mysql:
    image: mysql:8.0.23
    restart: always
    environment:
      <<: *mysql
    ports:
      - 3306:3306
    expose:
      - '3306'
    volumes:
      # on the left side of the semicolon is the directory in which Docker looks for init.sql
      - ./docker/mysql:/docker-entrypoint-initdb.d
      - mysql_data:/var/lib/mysql
    container_name: mysql
    networks:
      - common-network

# Adminer visualises the data in the database. It is accessible in the browser at localhost:8888
  adminer:
    image: adminer:4.8.0-standalone
    restart: always
    ports:
      - 8888:8080

volumes:
  tomcat:
  mysql_data:

networks:
  common-network:
      driver: bridge
